<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Modal</title>
    <link rel="stylesheet" href="../css/bootstrap.css">
    <script src="../js/bootstrap.js"></script>
    <script src="../js/jquery.js"></script>
    <link rel="stylesheet" href="../css/font.css">
    <link rel="stylesheet" href="../css/Login_Register_Modal.css">
</head>

<body>


    <!-- Bắt đầu Modal -->
    <div class="modal fade show" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="false">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 1440px; width: 100%; height: 700px;">
            <div class="modal-content" style="border-radius: 60px; overflow: hidden; border: none;">
                <div class="modal-body p-0">
                    <div class="auth-container">
                        <!-- Đăng nhập -->
                        <div class="form-container login-form">
                            <h3 class="fw-bold text-center mb-4">Nice to see you again</h3>
                            <form>
                                <div class="mb-3 w-100">
                                    <label class="form-label">Login</label>
                                    <input type="email" class="form-control text-left"
                                        placeholder="Email or phone number">
                                </div>
                                <div class="mb-3 w-100">
                                    <label class="form-label">Password</label>
                                    <input type="password" class="form-control text-left"
                                        placeholder="Enter your Password here">
                                </div>
                                <button type="submit" class="btn btn-auth w-100">Sign in</button>
                            </form>

                            <p class="mt-3 text-center">Don't have an account? <span class="toggle-form"
                                    id="show-register">Sign up</span></p>
                            <p class="text-center">- OR -</p>

                            <div class="social-login">
                                <button class="social-btn">
                                    <img src="../svg/Google.svg" alt="Google">
                                    Log in with Google
                                </button>
                                <button class="social-btn">
                                    <img src="../svg/2023_Facebook_icon.svg.svg" alt="Facebook">
                                    Log in with Facebook
                                </button>
                            </div>
                        </div>

                        <!-- Đăng ký -->
                        <div class="form-container register-form">
                            <h3 class="fw-bold text-center mb-4">Create your Free Account</h3>
                            <form>
                                <div class="mb-3 w-100">
                                    <label class="form-label">Name</label>
                                    <input type="text" class="form-control text-left"
                                        placeholder="Enter your Account Name here">
                                </div>
                                <div class="mb-3 w-100">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control text-left"
                                        placeholder="Enter your Email here">
                                </div>
                                <div class="mb-3 w-100">
                                    <label class="form-label">Password</label>
                                    <input type="password" class="form-control text-left"
                                        placeholder="Enter your Password here">
                                </div>
                                <button type="submit" class="btn btn-auth w-100">Create Account</button>
                            </form>

                            <p class="mt-3 text-center">Already have a account? <span class="toggle-form"
                                    id="show-login">Log in</span></p>
                            <p class="text-center">- OR -</p>

                            <div class="social-login">
                                <button class="social-btn">
                                    <img src="../svg/Google.svg" alt="Google">
                                    Sign up with Google
                                </button>
                                <button class="social-btn">
                                    <img src="../svg/2023_Facebook_icon.svg.svg" alt="Facebook">
                                    Sign up with Facebook
                                </button>
                            </div>
                        </div>

                        <!-- Ảnh cho Đăng nhập -->
                        <div class="image-container left-image gradient-bg">
                            <div class="blobs-container">
                                <div class="main-img-blobs"></div>
                                <div class="blobs-vector-1"></div>
                                <div class="blobs-vector-2"></div>
                                <div class="blobs-vector-3"></div>
                            </div>
                        </div>

                        <!-- Ảnh cho Đăng Ký -->
                        <div class="image-container right-image gradient-bg">
                            <div class="blobs-container">
                                <div class="main-img-blobs"></div>
                                <div class="blobs-vector-1"></div>
                                <div class="blobs-vector-2"></div>
                                <div class="blobs-vector-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            var myModal = new bootstrap.Modal($('#authModal')[0]);
            myModal.show();
            // Biến lưu trữ người dùng trong localStorage
            const USERS_KEY = 'registered_users';

            // Khởi tạo danh sách người dùng nếu chưa có
            if (!localStorage.getItem(USERS_KEY)) {
                localStorage.setItem(USERS_KEY, JSON.stringify([]));
            }

            const $container = $('.auth-container');
            const $showRegisterBtn = $('#show-register');
            const $showLoginBtn = $('#show-login');

            $showRegisterBtn.on('click', () => {
                $container.addClass('active');
            });

            $showLoginBtn.on('click', () => {
                $container.removeClass('active');
            });

            $('#authModal').on('click', function (event) {
                if (event.target === this) {
                    const modalInstance = bootstrap.Modal.getInstance(this);
                    modalInstance.hide();
                }
            });
            $registerForm.on('submit', function (e) {
                e.preventDefault();

                const name = $(this).find('input[type="text"]').val().trim();
                const email = $(this).find('input[type="email"]').val().trim();
                const password = $(this).find('input[type="password"]').val().trim();

                // Kiểm tra dữ liệu nhập vào
                if (!name || !email || !password) {
                    alert('Vui lòng điền đầy đủ thông tin!');
                    return;
                }

                // Lấy danh sách người dùng từ localStorage
                const users = JSON.parse(localStorage.getItem(USERS_KEY));

                // Kiểm tra email đã tồn tại chưa
                const userExists = users.some(user => user.email === email);
                if (userExists) {
                    alert('Email này đã được đăng ký!');
                    return;
                }

                // Thêm người dùng mới
                users.push({
                    name: name,
                    email: email,
                    password: password
                });

                // Lưu vào localStorage
                localStorage.setItem(USERS_KEY, JSON.stringify(users));

                alert('Đăng ký thành công! Bạn có thể đăng nhập ngay bây giờ.');
                $container.removeClass('active'); // Chuyển về form đăng nhập
                $registerForm.trigger('reset'); // Reset form đăng ký
            });

            // Xử lý đăng nhập
            $loginForm.on('submit', function (e) {
                e.preventDefault();

                const login = $(this).find('input[type="email"]').val().trim();
                const password = $(this).find('input[type="password"]').val().trim();

                // Kiểm tra dữ liệu nhập vào
                if (!login || !password) {
                    alert('Vui lòng điền đầy đủ thông tin!');
                    return;
                }

                // Lấy danh sách người dùng từ localStorage
                const users = JSON.parse(localStorage.getItem(USERS_KEY));

                // Tìm người dùng phù hợp
                const user = users.find(u =>
                    (u.email === login || u.phone === login) && u.password === password
                );

                if (user) {
                    // Hiển thị thông báo thành công
                    alert('Đăng nhập thành công! Bạn sẽ được chuyển về trang chủ.');

                    // Lưu thông tin người dùng hiện tại
                    localStorage.setItem('current_user', JSON.stringify(user));

                    // Đóng modal
                    const modalInstance = bootstrap.Modal.getInstance($('#authModal')[0]);
                    modalInstance.hide();

                    // Chuyển hướng về trang home.html sau khi nhấn OK
                    window.location.href = 'home.html';
                } else {
                    alert('Email hoặc mật khẩu không đúng!');
                }
            });
        });

    </script>

</body>

</html>